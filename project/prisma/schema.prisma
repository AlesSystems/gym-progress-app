generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  password      String?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  workouts      Workout[]
  teamMemberships TeamMember[]

  @@index([email])
}

model Workout {
  id        String   @id @default(cuid())
  userId    String
  name      String
  date      DateTime
  notes     String?
  duration  Int?     // in minutes
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercises WorkoutExercise[]

  @@index([userId])
  @@index([date])
}

model Exercise {
  id           String   @id @default(cuid())
  name         String   @unique
  category     String
  muscleGroups String[]
  description  String?
  isCustom     Boolean  @default(false)
  createdById  String?
  createdAt    DateTime @default(now())

  workoutExercises WorkoutExercise[]

  @@index([name])
  @@index([category])
}

model WorkoutExercise {
  id         String   @id @default(cuid())
  workoutId  String
  exerciseId String
  order      Int
  notes      String?

  workout  Workout    @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise Exercise   @relation(fields: [exerciseId], references: [id])
  sets     ExerciseSet[]

  @@index([workoutId])
}

model ExerciseSet {
  id                String  @id @default(cuid())
  workoutExerciseId String
  setNumber         Int
  weight            Float?
  reps              Int?
  duration          Int?    // in seconds
  distance          Float?
  notes             String?

  workoutExercise WorkoutExercise @relation(fields: [workoutExerciseId], references: [id], onDelete: Cascade)

  @@index([workoutExerciseId])
}

model Team {
  id        String   @id @default(cuid())
  name      String
  inviteCode String  @unique @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  members TeamMember[]

  @@index([inviteCode])
}

model TeamMember {
  id       String   @id @default(cuid())
  teamId   String
  userId   String
  role     String   @default("member") // "admin" | "member"
  joinedAt DateTime @default(now())

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
}

model VerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  email     String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([token])
}

